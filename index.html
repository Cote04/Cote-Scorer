<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Card Scorer</title>

  <style>
    :root{
      --bg0:#050816;
      --bg1:#0b1022;
      --card:#101a33;
      --card2:#0c1328;
      --text:#f3f6ff;
      --muted:rgba(243,246,255,.68);
      --stroke:rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:22px;
      --gap:14px;
      --accent:#f97316;
      --accent2:rgba(249,115,22,.18);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(99,102,241,.30), transparent 55%),
        radial-gradient(900px 600px at 110% 10%, rgba(249,115,22,.26), transparent 58%),
        radial-gradient(1200px 700px at 30% 115%, rgba(34,211,238,.20), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* App shell */
    .app{
      min-height:100%;
      display:flex;
      flex-direction:column;
      padding: calc(14px + var(--safe-top)) 14px calc(16px + var(--safe-bottom));
      gap:14px;
      max-width: 980px;
      margin: 0 auto;
    }

    /* Top bar */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 8px 4px 2px;
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(5,8,22,.72), rgba(5,8,22,.35) 70%, transparent);
      margin: calc(-14px - var(--safe-top)) -14px 0;
      padding-top: calc(14px + var(--safe-top));
      padding-left: 14px;
      padding-right: 14px;
    }

    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 0;
    }

    .brand-badge{
      width:42px; height:42px;
      border-radius: 14px;
      background:
        radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(16px 16px at 75% 20%, rgba(255,255,255,.20), transparent 60%),
        linear-gradient(135deg, rgba(249,115,22,.95), rgba(99,102,241,.95));
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.14);
      flex: 0 0 auto;
    }

    .brand h1{
      font-size: 18px;
      margin:0;
      letter-spacing:.2px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .brand .sub{
      font-size: 12.5px;
      color: var(--muted);
      margin-top: 3px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
    }

    .iconbtn{
      width:42px; height:42px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      box-shadow: 0 10px 26px rgba(0,0,0,.26);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
    }
    .iconbtn:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.16); }
    .iconbtn:active{ transform: scale(.98); }
    .iconbtn svg{ width:19px; height:19px; opacity:.92; }

    /* Search row */
    .searchRow{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top: 6px;
    }
    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--stroke);
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
    }
    .search svg{ width:18px; height:18px; opacity:.85; flex:0 0 auto; }
    .search input{
      width:100%;
      border:0;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size: 14.5px;
    }
    .search input::placeholder{ color: rgba(243,246,255,.55); }

    .pill{
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 10px 12px;
      font-size: 13px;
      color: rgba(243,246,255,.86);
      cursor:pointer;
      user-select:none;
      transition: background .18s ease, transform .08s ease;
      display:flex; align-items:center; gap:8px;
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
    }
    .pill:active{ transform: scale(.99); }
    .pill .dot{ width:8px; height:8px; border-radius:50%; background: var(--accent); box-shadow: 0 0 0 4px var(--accent2); }

    /* Section title */
    .sectionTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      margin-top: 6px;
      padding: 0 2px;
    }
    .sectionTitle h2{
      font-size: 14px;
      margin:0;
      letter-spacing:.35px;
      color: rgba(243,246,255,.88);
      text-transform: uppercase;
    }
    .sectionTitle .count{
      font-size: 12px;
      color: var(--muted);
    }

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: var(--gap);
    }
    @media (min-width: 760px){
      .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    }

    /* Game card */
    .card{
      position:relative;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(140px 120px at 30% 18%, rgba(255,255,255,.14), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04)),
        linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 170px;
      cursor:pointer;
      transition: transform .10s ease, border-color .18s ease, filter .18s ease;
      user-select:none;
    }
    .card:hover{ border-color: rgba(255,255,255,.18); filter: brightness(1.02); }
    .card:active{ transform: scale(.99); }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(300px 140px at 30% 0%, var(--glow, rgba(249,115,22,.28)), transparent 60%);
      pointer-events:none;
    }

    .cardInner{
      position:relative;
      display:flex;
      flex-direction:column;
      height:100%;
      padding: 14px;
      gap:10px;
    }

    .logoWrap{
      height: 82px;
      border-radius: 18px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .logoWrap img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display:block;
      padding: 10px;
      filter: drop-shadow(0 12px 16px rgba(0,0,0,.35));
    }
    /* For logos that have transparency but still look “boxed”, this can help */
/*    .logoWrap.hasTrans{
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.12), transparent 65%),
        rgba(0,0,0,.18);
    }
*/
    .meta{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-top: 2px;
      min-height: 54px;
    }

    .nameRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:8px;
    }

    .gameName{
      font-size: 15.5px;
      line-height:1.15;
      margin:0;
      letter-spacing:.2px;
      text-shadow: 0 8px 22px rgba(0,0,0,.35);
    }

    .tag{
      font-size: 11px;
      padding: 6px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(243,246,255,.84);
      white-space:nowrap;
      flex:0 0 auto;
    }

    .desc{
      font-size: 12.5px;
      color: var(--muted);
      line-height:1.25;
      margin:0;
      display:-webkit-box;
      -webkit-line-clamp: 6;
      -webkit-box-orient: vertical;
      overflow:hidden;
      min-height: 32px;
    }

    .foot{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-top: 6px;
    }

    .last{
      font-size: 12px;
      color: rgba(243,246,255,.68);
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .last svg{ width:14px; height:14px; opacity:.85; }

    .play{
      border-radius: 14px;
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: rgba(255,255,255,.92);
      font-size: 12.5px;
      display:flex;
      align-items:center;
      gap:8px;
      flex:0 0 auto;
      box-shadow: 0 14px 30px rgba(0,0,0,.22);
    }
    .play svg{ width:14px; height:14px; }

    /* Empty state */
    .empty{
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: var(--radius);
      padding: 18px;
      background: rgba(255,255,255,.04);
      color: rgba(243,246,255,.80);
      text-align:center;
      box-shadow: 0 14px 40px rgba(0,0,0,.18);
    }
    .empty p{ margin: 8px 0 0; color: var(--muted); font-size: 13px; }

    /* Modal */
    .modalBackdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 16px;
      padding-bottom: calc(16px + var(--safe-bottom));
      z-index: 50;
    }
    .modalBackdrop.open{ display:flex; }
    .sheet{
      width:min(560px, 100%);
      border-radius: 24px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(420px 220px at 20% 0%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(16,26,51,.92), rgba(10,16,34,.92));
      box-shadow: 0 24px 80px rgba(0,0,0,.60);
      overflow:hidden;
    }
    .sheetHead{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .sheetHead h3{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
      text-transform: uppercase;
      color: rgba(243,246,255,.90);
    }
    .closeX{
      width:40px; height:40px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .sheetBody{
      padding: 14px 16px 16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height: 72vh;
      overflow:auto;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .row strong{ font-size: 13.5px; }
    .row span{ font-size: 12.5px; color: var(--muted); }
    .row button{
      border-radius: 14px;
      padding: 10px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }

    /* Tiny toast */
    .toast{
      position:fixed;
      left:50%;
      bottom: calc(14px + var(--safe-bottom));
      transform: translateX(-50%);
      background: rgba(10,16,34,.92);
      border:1px solid rgba(255,255,255,.14);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      color: rgba(243,246,255,.92);
      font-size: 12.5px;
      display:none;
      z-index: 80;
      max-width: calc(100% - 28px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toast.show{ display:block; animation: pop .18s ease-out; }
    @keyframes pop { from{ transform: translateX(-50%) translateY(8px); opacity:.0 } to{ transform: translateX(-50%) translateY(0); opacity:1 } }

  </style>
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="brand" role="banner">
        <div class="brand-badge" aria-hidden="true"></div>
        <div style="min-width:0;">
          <h1>Card Scorer</h1>
          <div class="sub" id="subtitle">2 scorers • ready for more</div>
        </div>
      </div>

      <div class="actions">
        <button class="iconbtn" id="btnSearch" title="Focus search" aria-label="Focus search">
          <!-- search icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="7"></circle>
            <path d="M20 20l-3.2-3.2"></path>
          </svg>
        </button>

        <button class="iconbtn" id="btnSettings" title="Settings" aria-label="Settings">
          <!-- sliders icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 21v-7"></path><path d="M4 10V3"></path>
            <path d="M12 21v-9"></path><path d="M12 8V3"></path>
            <path d="M20 21v-5"></path><path d="M20 12V3"></path>
            <path d="M2 14h4"></path><path d="M10 8h4"></path><path d="M18 16h4"></path>
          </svg>
        </button>
      </div>
    </header>

    <div class="searchRow">
      <div class="search" id="searchBox">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="7"></circle>
          <path d="M20 20l-3.2-3.2"></path>
        </svg>
        <input id="q" type="text" placeholder="Search scorers…" autocomplete="off" />
      </div>

      <div class="pill" id="pillView" title="Toggle grid density">
        <div class="dot" aria-hidden="true"></div>
        <span id="pillText">Comfort</span>
      </div>
    </div>

    <div class="sectionTitle">
      <h2>Games</h2>
      <div class="count" id="countLabel">—</div>
    </div>

    <main id="grid" class="grid" aria-label="Game scorer grid"></main>

    <div id="empty" class="empty" style="display:none;">
      <strong>No matches</strong>
      <p>Try a different search.</p>
    </div>
  </div>

  <!-- Settings / Manage Games sheet -->
  <div class="modalBackdrop" id="backdrop" role="dialog" aria-modal="true" aria-label="Settings">
    <div class="sheet">
      <div class="sheetHead">
        <h3>Settings</h3>
        <div class="closeX" id="closeSheet" aria-label="Close">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
        </div>
      </div>
      <div class="sheetBody" id="sheetBody">
        <!-- filled by JS -->
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Saved</div>

  <script>
    /*****************************************************************
     * CONFIG (inline fallback)
     * - You can ALSO place a scorers.json next to this file.
     * - If running from file://, many browsers block fetch() for local
     *   files. Inline fallback will still work.
     *****************************************************************/
    const INLINE_CONFIG = {
      appTitle: "Card Scorer",
      subtitle: "2 scorers • ready for more",
      configUrl: "./scorers.json", // optional external config
      scorers: [
        {
          id: "canadian-salad",
          name: "Canadian Salad",
          description: "Fast scoring with rule helpers, colors, and winner highlight.",
          tag: "Popular",
          themeGlow: "rgba(249,115,22,.30)",
          logo: "./assets/canadian-salad.png",  // change to your transparent PNG path
          route: "./canadian-salad/index.html", // or "./CanadianSaladScorer.html"
          lastPlayed: "Yesterday"
        },
        {
          id: "five-crowns",
          name: "Five Crowns",
          description: "Round-by-round scoring with wild cards and totals.",
          tag: "New",
          themeGlow: "rgba(99,102,241,.30)",
          logo: "./assets/five-crowns.png",
          route: "./five-crowns/index.html",
          lastPlayed: "Dec 30"
        }
      ]
    };

    /*****************************************************************
     * STATE
     *****************************************************************/
    const state = {
      density: localStorage.getItem("hub_density") || "comfort", // comfort | compact
      q: "",
      config: null,
      filtered: []
    };

    const els = {
      title: document.querySelector("title"),
      subtitle: document.getElementById("subtitle"),
      grid: document.getElementById("grid"),
      empty: document.getElementById("empty"),
      count: document.getElementById("countLabel"),
      input: document.getElementById("q"),
      btnSearch: document.getElementById("btnSearch"),
      btnSettings: document.getElementById("btnSettings"),
      backdrop: document.getElementById("backdrop"),
      closeSheet: document.getElementById("closeSheet"),
      sheetBody: document.getElementById("sheetBody"),
      pillView: document.getElementById("pillView"),
      pillText: document.getElementById("pillText"),
      toast: document.getElementById("toast")
    };

    /*****************************************************************
     * HELPERS
     *****************************************************************/
    function showToast(msg){
      els.toast.textContent = msg;
      els.toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>els.toast.classList.remove("show"), 1400);
    }

    function setDensity(d){
      state.density = d;
      localStorage.setItem("hub_density", d);
      els.pillText.textContent = d === "compact" ? "Compact" : "Comfort";
      // tweak card min-height for compact mode
      document.documentElement.style.setProperty("--gap", d === "compact" ? "12px" : "14px");
      document.querySelectorAll(".card").forEach(card=>{
        card.style.minHeight = (d === "compact" ? "154px" : "170px");
      });
    }

    function normalize(s){ return (s||"").toLowerCase().trim(); }

    function formatCount(n, total){
      if (n === total) return `${total} scorers`;
      return `${n} of ${total}`;
    }

    function openSheet(){
      els.backdrop.classList.add("open");
    }
    function closeSheet(){
      els.backdrop.classList.remove("open");
    }

    function updateLastPlayed(id){
      const key = "hub_lastplayed_" + id;
      localStorage.setItem(key, new Date().toISOString());
    }

    function readLastPlayed(id){
      const key = "hub_lastplayed_" + id;
      const iso = localStorage.getItem(key);
      if(!iso) return null;
      const dt = new Date(iso);
      // simple friendly label
      const now = new Date();
      const diffDays = Math.floor((now - dt) / (1000*60*60*24));
      if (diffDays <= 0) return "Today";
      if (diffDays === 1) return "Yesterday";
      return dt.toLocaleDateString(undefined, { month: "short", day: "numeric" });
    }

    /*****************************************************************
     * RENDER
     *****************************************************************/
    function render(){
      const cfg = state.config;
      const all = cfg.scorers || [];

      const q = normalize(state.q);
      const filtered = all.filter(s => {
        const hay = normalize(`${s.name} ${s.description} ${s.tag}`);
        return hay.includes(q);
      });

      state.filtered = filtered;

      els.grid.innerHTML = "";
      els.empty.style.display = filtered.length ? "none" : "block";
      els.count.textContent = formatCount(filtered.length, all.length);

      // subtitle updates
      els.subtitle.textContent = cfg.subtitle || `${all.length} scorers`;

      filtered.forEach(s => {
        const card = document.createElement("article");
        card.className = "card";
        card.style.setProperty("--glow", s.themeGlow || "rgba(249,115,22,.26)");
        card.setAttribute("tabindex", "0");
        card.setAttribute("role", "button");
        card.setAttribute("aria-label", `Open ${s.name} scorer`);

        const inner = document.createElement("div");
        inner.className = "cardInner";

        const logoWrap = document.createElement("div");
        logoWrap.className = "logoWrap";
        if (s.logo) logoWrap.classList.add("hasTrans");

        const img = document.createElement("img");
        img.alt = `${s.name} logo`;
        img.loading = "lazy";
        img.src = s.logo || "";
        img.onerror = () => {
          // fallback: simple initials badge if image missing
          img.remove();
          const fallback = document.createElement("div");
          fallback.style.width = "100%";
          fallback.style.height = "100%";
          fallback.style.display = "grid";
          fallback.style.placeItems = "center";
          fallback.style.fontSize = "20px";
          fallback.style.fontWeight = "700";
          fallback.style.letterSpacing = "0.5px";
          fallback.style.color = "rgba(255,255,255,.9)";
          fallback.textContent = (s.name || "?").split(" ").slice(0,2).map(w=>w[0]).join("").toUpperCase();
          logoWrap.appendChild(fallback);
        };
        logoWrap.appendChild(img);

        const meta = document.createElement("div");
        meta.className = "meta";

        const nameRow = document.createElement("div");
        nameRow.className = "nameRow";

        const h = document.createElement("h3");
        h.className = "gameName";
        h.textContent = s.name || "Untitled";

        const tag = document.createElement("div");
        tag.className = "tag";
        tag.textContent = s.tag || "Scorer";

        nameRow.appendChild(h);
        nameRow.appendChild(tag);

        const d = document.createElement("p");
        d.className = "desc";
        d.textContent = s.description || "";

        const foot = document.createElement("div");
        foot.className = "foot";

        const last = document.createElement("div");
        last.className = "last";
        const lp = readLastPlayed(s.id) || s.lastPlayed || "—";
        last.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 8v5l3 2"></path>
            <circle cx="12" cy="12" r="9"></circle>
          </svg>
          <span>Last: ${lp}</span>
        `;

        const play = document.createElement("div");
        play.className = "play";
        play.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 5v14l11-7z"></path>
          </svg>
          <span>Open</span>
        `;

        foot.appendChild(last);
        foot.appendChild(play);

        meta.appendChild(nameRow);
        meta.appendChild(d);

        inner.appendChild(logoWrap);
        inner.appendChild(meta);
        inner.appendChild(foot);

        card.appendChild(inner);

        const openScorer = () => {
          updateLastPlayed(s.id);
          // If you want in-app navigation later, replace with router logic.
          if (s.route) {
            window.location.href = s.route;
          } else {
            showToast("No route configured for this scorer.");
          }
        };

        card.addEventListener("click", openScorer);
        card.addEventListener("keydown", (e)=>{
          if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openScorer(); }
        });

        els.grid.appendChild(card);
      });

      // apply density after cards exist
      setDensity(state.density);
    }

    function renderSheet(){
      const cfg = state.config;
      const all = cfg.scorers || [];
      els.sheetBody.innerHTML = "";

      // Global toggles (example)
      const row1 = document.createElement("div");
      row1.className = "row";
      row1.innerHTML = `
        <div>
          <strong>Grid density</strong><br/>
          <span>${state.density === "compact" ? "Compact" : "Comfort"} spacing</span>
        </div>
        <button id="toggleDensity">${state.density === "compact" ? "Use comfort" : "Use compact"}</button>
      `;
      els.sheetBody.appendChild(row1);

      // Manage games list
      const header = document.createElement("div");
      header.style.marginTop = "6px";
      header.style.color = "rgba(243,246,255,.88)";
      header.style.fontSize = "13px";
      header.style.letterSpacing = ".25px";
      header.textContent = "Games (config-driven)";
      els.sheetBody.appendChild(header);

      all.forEach(s => {
        const r = document.createElement("div");
        r.className = "row";
        r.innerHTML = `
          <div style="min-width:0;">
            <strong style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.name}</strong>
            <span style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${s.route || "No route set"}</span>
          </div>
          <button data-open="${s.id}">Open</button>
        `;
        r.querySelector("button").addEventListener("click", () => {
          closeSheet();
          updateLastPlayed(s.id);
          if (s.route) window.location.href = s.route;
          else showToast("No route configured.");
        });
        els.sheetBody.appendChild(r);
      });

      // wiring for density button
      const toggle = row1.querySelector("#toggleDensity");
      toggle.addEventListener("click", () => {
        const next = state.density === "compact" ? "comfort" : "compact";
        setDensity(next);
        render();      // rebuild cards with new sizing
        renderSheet(); // update button label
        showToast("Updated");
      });
    }

    /*****************************************************************
     * LOAD CONFIG (external scorers.json if possible, else inline)
     *****************************************************************/
    async function loadConfig(){
      // start with inline
      let cfg = structuredClone(INLINE_CONFIG);

      // try external config (safe: if blocked/fails, fallback to inline)
      try{
        if (cfg.configUrl){
          const res = await fetch(cfg.configUrl, { cache: "no-store" });
          if (res.ok){
            const external = await res.json();
            // shallow merge so external can override title/subtitle/scorers
            cfg = { ...cfg, ...external };
          }
        }
      }catch(err){
        // common when opened via file:// — fetch blocked
      }

      // apply title/subtitle
      document.querySelector(".brand h1").textContent = cfg.appTitle || "Card Scorer";
      els.title.textContent = cfg.appTitle || "Card Scorer";
      state.config = cfg;

      // subtitle count
      const n = (cfg.scorers || []).length;
      els.subtitle.textContent = cfg.subtitle || `${n} scorer${n===1?"":"s"}`;

      render();
      renderSheet();
    }

    /*****************************************************************
     * EVENTS
     *****************************************************************/
    els.input.addEventListener("input", (e)=>{
      state.q = e.target.value;
      render();
    });

    els.btnSearch.addEventListener("click", ()=>{
      els.input.focus();
    });

    els.pillView.addEventListener("click", ()=>{
      const next = state.density === "compact" ? "comfort" : "compact";
      setDensity(next);
      render();
      renderSheet();
      showToast("Updated");
    });

    els.btnSettings.addEventListener("click", ()=>{
      openSheet();
    });
    els.closeSheet.addEventListener("click", closeSheet);
    els.backdrop.addEventListener("click", (e)=>{
      if (e.target === els.backdrop) closeSheet();
    });

    // Escape closes sheet
    window.addEventListener("keydown", (e)=>{
      if (e.key === "Escape") closeSheet();
    });

    /*****************************************************************
     * INIT
     *****************************************************************/
    loadConfig();
  </script>
</body>
</html>
