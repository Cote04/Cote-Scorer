<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scorekeeper Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <meta name="theme-color" content="#050816" />

  <style>
    :root {
      /* Matches your existing scorer look & feel */
      --bg: #050816;
      --bg-soft: #0c1224;
      --card: #111827;
      --card-soft: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.14);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2933;
      --winner-glow: 0 0 0 2px rgba(52, 211, 153, 0.7);

      --radius: 18px;
      --shadow: 0 16px 40px rgba(0,0,0,0.35);
    }

    * { box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(249,115,22,0.18), transparent 60%),
        radial-gradient(1000px 650px at 85% 15%, rgba(56,189,248,0.12), transparent 55%),
        radial-gradient(900px 600px at 40% 110%, rgba(34,197,94,0.10), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg-soft));
      overflow-x: hidden;
    }

    /* Safe-area handling for Android/iOS notches/status bars */
    .safe {
      padding-top: max(14px, env(safe-area-inset-top));
      padding-bottom: max(14px, env(safe-area-inset-bottom));
      padding-left: max(14px, env(safe-area-inset-left));
      padding-right: max(14px, env(safe-area-inset-right));
      min-height: 100%;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 28px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(17, 24, 39, 0.72);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: sticky;
      top: max(10px, env(safe-area-inset-top));
      z-index: 10;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .brand h1 {
      margin: 0;
      font-size: 18px;
      line-height: 1.1;
      letter-spacing: 0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .brand p {
      margin: 0;
      color: var(--text-muted);
      font-size: 13px;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(180deg, rgba(31,41,55,0.92), rgba(17,24,39,0.92));
      color: var(--text-main);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 650;
      font-size: 13px;
      letter-spacing: 0.2px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.25);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      touch-action: manipulation;
    }

    .btn:hover { border-color: rgba(249,115,22,0.55); }
    .btn:active { transform: translateY(1px); }
    .btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(249,115,22,0.25), 0 10px 22px rgba(0,0,0,0.25);
      border-color: rgba(249,115,22,0.7);
    }

    .btn-accent {
      border-color: rgba(249,115,22,0.55);
      background: linear-gradient(180deg, rgba(249,115,22,0.22), rgba(17,24,39,0.92));
    }

    .content {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .panel {
      border: 1px solid var(--border-subtle);
      background: rgba(17, 24, 39, 0.72);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .panel h2 {
      margin: 0 0 6px;
      font-size: 14px;
      letter-spacing: 0.2px;
      color: var(--text-main);
    }

    .panel .sub {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .grid {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 12px;
    }

    @media (min-width: 720px) {
      .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (min-width: 980px) {
      .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .card {
      border: 1px solid var(--border-subtle);
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(31,41,55,0.85), rgba(17,24,39,0.85));
      box-shadow: 0 16px 30px rgba(0,0,0,0.25);
      padding: 14px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      min-height: 92px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
      user-select: none;
      touch-action: manipulation;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -2px;
      background:
        radial-gradient(700px 140px at 15% 20%, rgba(249,115,22,0.20), transparent 60%),
        radial-gradient(700px 160px at 85% 80%, rgba(56,189,248,0.10), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .card:hover { border-color: rgba(249,115,22,0.55); }
    .card:active { transform: translateY(1px); }
    .card:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(249,115,22,0.25), 0 16px 30px rgba(0,0,0,0.25);
      border-color: rgba(249,115,22,0.7);
    }

    .card .name {
      position: relative;
      z-index: 1;
      margin: 0;
      font-size: 16px;
      font-weight: 750;
      letter-spacing: 0.2px;
    }

    .card .meta {
      position: relative;
      z-index: 1;
      margin: 0;
      font-size: 12.5px;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .badge {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 2;
      font-size: 11px;
      font-weight: 750;
      letter-spacing: 0.3px;
      padding: 6px 10px;
      border-radius: 999px;
      color: var(--text-main);
      border: 1px solid rgba(249,115,22,0.35);
      background: rgba(249,115,22,0.12);
      backdrop-filter: blur(6px);
    }

    .status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(17, 24, 39, 0.55);
      color: var(--text-muted);
      font-size: 13px;
    }

    .status strong { color: var(--text-main); }

    .error {
      border-color: rgba(239, 68, 68, 0.35);
      background: rgba(239, 68, 68, 0.10);
      color: #fecaca;
    }

    .foot {
      margin-top: 14px;
      color: var(--text-muted);
      font-size: 12.5px;
      text-align: center;
    }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
  <div class="safe">
    <div class="wrap">

      <header class="topbar">
        <div class="brand">
          <h1>Scorekeeper Hub</h1>
          <p>Select a scorer to start a game</p>
        </div>

        <div class="actions">
          <button id="reloadBtn" class="btn btn-accent" type="button" title="Reload scorers">
            ⟳ Reload
          </button>
        </div>
      </header>

      <main class="content">
        <section class="panel">
          <h2>Available Scorers</h2>
          <p class="sub">Defined in <span class="mono">scorers.json</span>. Add more scorers there and they’ll appear automatically.</p>

          <div id="status" class="status" aria-live="polite">
            <span>Loading scorers…</span>
            <span id="count"></span>
          </div>

          <div id="grid" class="grid" role="list"></div>

          <p class="foot">
            Tip: If you’re hosting on GitHub Pages, keep URLs relative like <span class="mono">./five-crowns/index.html</span>.
          </p>
        </section>
      </main>

    </div>
  </div>

  <script>
    (function () {
      const CONFIG_URL = "./scorers.json";

      const grid = document.getElementById("grid");
      const statusEl = document.getElementById("status");
      const countEl = document.getElementById("count");
      const reloadBtn = document.getElementById("reloadBtn");

      reloadBtn.addEventListener("click", () => loadScorers({ bustCache: true }));

      function setStatus(message, { isError = false } = {}) {
        statusEl.classList.toggle("error", isError);
        statusEl.firstElementChild.textContent = message;
      }

      function setCount(n) {
        countEl.textContent = (typeof n === "number") ? `${n} found` : "";
      }

      function clearGrid() {
        while (grid.firstChild) grid.removeChild(grid.firstChild);
      }

      function isValidScorer(s) {
        return s
          && typeof s.id === "string" && s.id.trim()
          && typeof s.name === "string" && s.name.trim()
          && typeof s.url === "string" && s.url.trim();
      }

      function normalizeUrl(url) {
        // Keep as-is; this is intentionally simple for GitHub Pages + Capacitor
        return url.trim();
      }

      function goTo(url) {
        window.location.href = url;
      }

      function createCard(scorer, index) {
        const card = document.createElement("button");
        card.type = "button";
        card.className = "card";
        card.setAttribute("role", "listitem");
        card.setAttribute("aria-label", `Open ${scorer.name} scorer`);

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = "SCORER";

        const name = document.createElement("p");
        name.className = "name";
        name.textContent = scorer.name;

        const meta = document.createElement("p");
        meta.className = "meta";
        meta.textContent = normalizeUrl(scorer.url);

        card.appendChild(badge);
        card.appendChild(name);
        card.appendChild(meta);

        card.addEventListener("click", () => goTo(normalizeUrl(scorer.url)));

        // Keyboard polish: Enter/Space already handled by button, but keep it snappy
        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            goTo(normalizeUrl(scorer.url));
          }
        });

        return card;
      }

      async function loadScorers({ bustCache = false } = {}) {
        clearGrid();
        setCount("");
        setStatus("Loading scorers…");

        try {
          const url = bustCache ? `${CONFIG_URL}?v=${Date.now()}` : CONFIG_URL;
          const res = await fetch(url, { cache: "no-store" });

          if (!res.ok) {
            throw new Error(`Failed to load scorers.json (HTTP ${res.status})`);
          }

          const data = await res.json();
          const list = Array.isArray(data?.scorers) ? data.scorers : [];

          const valid = [];
          const seenIds = new Set();

          for (const s of list) {
            if (!isValidScorer(s)) {
              console.warn("Skipping invalid scorer entry:", s);
              continue;
            }
            const id = s.id.trim();
            if (seenIds.has(id)) {
              console.warn("Skipping duplicate scorer id:", id);
              continue;
            }
            seenIds.add(id);
            valid.push({
              id,
              name: s.name.trim(),
              url: s.url.trim()
            });
          }

          if (valid.length === 0) {
            setStatus("No scorers available. Add entries to scorers.json.", { isError: false });
            setCount(0);
            return;
          }

          valid.forEach((s, idx) => grid.appendChild(createCard(s, idx)));
          setStatus("Select a scorer to begin.");
          setCount(valid.length);

        } catch (err) {
          console.error(err);
          setStatus("Could not load scorers. Check scorers.json path and JSON format.", { isError: true });
          setCount("");
        }
      }

      // Initial load
      loadScorers();
    })();
  </script>
</body>
</html>
